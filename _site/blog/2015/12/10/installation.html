
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta content="ChemBio Hub Website" property="og:site_name">
    <meta name="twitter:site" content="@oxchembiohub">
    <meta name="twitter:card" content="summary" />
    
	  <meta name="twitter:description" content="There are a number of other steps required to install the system which are noted in our install documents for CentOS and Ubuntu. 

In this blog post I am going to describe how we manage our python ...">
	
    
	  <meta content="Managing the ChemBio Hub Platform installation with conda and pip" property="og:title">
	  <meta name="twitter:title" content="Managing the ChemBio Hub Platform installation with conda and pip">
	
	
	  <meta content="http://chembiohub.ox.ac.uk/assets/img/cbh_og_logo.png" property="og:image">
	  <meta name="twitter:image:src" content="http://chembiohub.ox.ac.uk/assets/img/cbh_og_logo_thumb.png">
	
	
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> 
<link rel="alternate" type="application/rss+xml" title="Chembio Hub Blog" href="/feed.xml">
    <title>Managing the ChemBio Hub Platform installation with conda and pip - ChemBio Hub</title>

    <!-- concatenate all the used CSS in these files into clean.css -->
    <!-- build:css /assets/css/clean.css -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/font.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/bootstrapValidator.min.css"/>
    <!-- /build -->
    <link href="/assets/css/cbh-template-header.css" rel="stylesheet">


    <!-- Fonts from Google Fonts -->
  <!-- <link href='https://fonts.googleapis.com/css?family=Lato:300,400,900' rel='stylesheet' type='text/css'> -->

  <script src="/assets/js/vendorjs/jquery-1.11.1.min.js"></script>
    
  <script src="/assets/js/serialize-form.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
  	<!-- Fixed navbar -->
  	<nav class="navbar navbar-default" role="navigation">
  		<div class="container">


  			<div class="navbar-collapse collapse">
  				<ul class="nav navbar-nav navbar-right">
  					<li><a href="/">Home</a></li>
  					<li><a href="/about">About Us</a></li>
                    <li><a href="/applications">Applications</a></li>
  					<li><a href="/blog">Blog</a></li>
  					<li><a href="/events">Events</a></li>
  					<li><a href="#contact">Contact</a></li>
<!--             <li><a href="/whatsnext">What's next?</a></li>
-->            

			<!--<li><a href="/webauth/login">Login</a></li>-->
				</ul>

			</div>


<div class="navbar-header col-xs-12">
	<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	</button>


	<div class="col-sm-4 col-md-6">
		<div class="col-xs-6 col-sm-8 col-md-6">
			<a id="uni-logo" class="logo-oxweb col-6" href="http://www.ox.ac.uk" onclick='return !window.open(this.href);'>
				<img src="/assets/img/ox_brand1_rev_rect.gif" alt="University of Oxford logo" title="University of Oxford">
			</a>
		</div>
		<div class="col-sm-6 centered">
			<a id="cbh-logo"  href="/" class="hidden-xs hidden-sm col-6">
				<img src="/assets/img/CBH_2_2_LowRes.png" alt="ChemBioHub logo" title="ChemBioHub" style="max-height:78px;">
			</a>
		</div>
	</div>

	<div class="col-sm-8 col-md-6">
		<h1 class="pull-right">
			ChemBio Hub 
		</h1>
	</div>
</div>

</div>
</nav>

<nav id="subheading">
	<div class="container">
		<div class="row">
			<div class="col-sm-6 col-md-6" id="slogan">
				<!-- <h2>Supporting world-class chemical biology research</h2>-->
			</div>
			<div class="col-sm-6 col-md-6" id="social-icons">
				<a href="mailto:info@chembiohub.ox.ac.uk"><img src="/assets/img/social-icons/mail-icon.png" title="Email" alt="Email"></a>
				<a href="https://twitter.com/oxchembiohub" onclick='return !window.open(this.href);'><img src="/assets/img/social-icons/twitter.png" title="@OxChemBioHub" alt="@OxChemBioHub"></a>
				<a href="https://plus.google.com/106725711668905271458" onclick='return !window.open(this.href);'><img src="/assets/img/social-icons/google+.png" title="Google +" alt="Google +"></a>
				<a href="/blog/"><img src="/assets/img/social-icons/rss.png" title="ChemBio Hub blog" alt="ChemBio Hub Blog"></a>
				<a href="https://github.com/thesgc" onclick='return !window.open(this.href);'><img src="/assets/img/social-icons/GitHub-Mark-Light-32px.png" title="GitHub" alt="GitHub"></a>
			</div>
			<div class="login col-sm-6 hidden">

			</div>
		</div>
	</div>
</nav>


    <link href="/assets/css/blog-specific.css" rel="stylesheet">
	<div class="container">

		<div class="row">

			<div class="col-md-9 col-xs-12">

				
<div class="blog-intro">
	Welcome to the ChemBio Hub blog, a place for you to find out more about how we operate at a technical and collaborative level and how you can get involved. You can of course 
	visit the <a href="https://chembiohub.ox.ac.uk">ChemBio Hub website</a> and also follow us on Twitter <a href="https://twitter.com/oxchembiohub" onclick='return !window.open(this.href);'>@OxChemBioHub</a>
</div>
<div class='post'>
  <h1>Managing the ChemBio Hub Platform installation with conda and pip</h1>
  <div class='date'>posted 10 Dec 2015 by <a href="mailto:andrew.stretton@chembiohub.ox.ac.uk">Andrew Stretton</a></div>
  <div class='body'><p>There are a number of other steps required to install the system which are noted in our install documents for CentOS and Ubuntu. </p>

<p>In this blog post I am going to describe how we manage our python packages and our custom PostgreSQL database.</p>

<p>Developing with Python and JavaScript is often fast and efficient, but once a large number of dependencies are involved it is crucial to get the way you install the product under control. In order to do that, we combine a few package management technologies and develop approroiate scripts to make the package managers work together.</p>

<p>The 4 package managers used are for Python: conda and pip and for JavaScript npm and bower.</p>

<p>In our python development we have found the conda package manager to be great for installing large and complex scientific packages for image processing and cheminformatics. Wihtout conda these can take literally hours to compile and install but conda speeds all of these things up. It does this by having a templated binary installation that is tailored to the specific environment that you wish to install it in. </p>

<p>If the python code in one of your packages would normally call C code from the server shared libraries, these shared libaries can be packaged up with the conda package instead. The advantage nof this approach is that the package on conda can be set up to work across all operating systems. The disadvantage is that if the person who created the original conda package did not specify that C dependency you can get to an unexpected error that may be hard to debug. Another disadvantage is that if you are the only manager of a particular package, you will have to maintain that package and add updates as approapriate.</p>

<p>With these advantages and disadvantages in mind, the most pragmatic approach is to use Conda for the well-known packages that it is good at and to fill in the other small python packages with pip.</p>

<p>So how does Conda work?</p>

<p>Conda is installed using the installers for linux, mac or windows.</p>

<pre><code> wget https://3230d63b5fc54e62148e-c95ac804525aac4b6dba79b00b39d1d3.ssl.cf1.rackcdn.com/Anaconda2-2.4.0-Linux-x86_64.sh 
 bash Anaconda2-2.4.0-Linux-x86_64.sh -b    
 rm Anaconda2-2.4.0-Linux-x86_64.sh
 echo "export PATH=$HOME/anaconda2/bin/:\$PATH" &gt;&gt; ~/.bashrc
 #source ~/.bashrc
</code></pre>

<p>We then add the channels that we need for our dependencies - cairocffi, rdkit, rdkit-postgresql and openbabel.</p>

<pre><code>export PATH=$HOME/anaconda2/bin/:$PATH
conda config --add channels https://conda.anaconda.org/jeprescottroy
conda config --add channels https://conda.anaconda.org/rdkit
conda config --add channels https://conda.anaconda.org/clyde_fare
</code></pre>

<p>Following this we create a virtual environment for the project using an exported list of conda dependencies (exported using conda list -e).</p>

<pre><code>conda create -q -y --file anaconda_requirements.txt -n dev
</code></pre>

<p>The ChemBio Hub system is set up to use an environment called dev when in development, the environment name corresponds to the web folder the project will be hosted on.</p>

<p>After this is done we can activate the conda environment. This involves setting the system PATH</p>

<pre><code>source activate dev
</code></pre>

<p>The bash shell then changes to show you are in that environment</p>

<pre><code>(dev)chembiohub@chembiohub:~/
</code></pre>

<p>Now with the environment activated the pip and python we are using will point at anacondaâ€™s version, so even if you are on Mac OS or CentOS the python version will always be the same, in this case 2.7.10.</p>

<p>Now it is possible to install the other dependencies of ChemBio Hub and pull down all of the submodules:</p>

<pre><code>pip install -r pip_requirements.txt

git submodule init 
git submodule update
git submodule foreach git checkout master 
git submodule foreach git pull
</code></pre>

<p>PostgreSQL is also installed with conda and is added to the path in the virtual environment. As we do not want to have lots of different ports listening for postgres connections, we use a unix socket so that any instace of the application can have its own PostgreSQL installation. We do this by setting PostgreSQL to run in the background using supervisor.</p>

<p>Our install script sets this up by running the initdb command to create a tablespace folder for postgres then creating a socket directory for the PostgreSQL process to communicate with.</p>

<pre><code>mkdir $CONDA_ENV_PATH/var/postgressocket
initdb -D $CONDA_ENV_PATH/var/postgresdata
$CONDA_ENV_PATH/bin/postgres  -D  $CONDA_ENV_PATH/var/postgresdata  -c  listen_addresses=''  -c  unix_socket_directories=$CONDA_ENV_PATH/var/postgressocket &amp;
sleep 5
</code></pre>

<p>It is then possible to create a datgabase specifying the socket as a host</p>

<pre><code>createdb -h $CONDA_ENV_PATH/var/postgressocket/ dev_db
</code></pre>

<p>The RDKit and HStore extensions that ChemBio Hub Platform uses are ready to set up and use</p>

<pre><code>psql  -h $CONDA_ENV_PATH/var/postgressocket -c "create extension hstore;create extension rdkit;" ${ENV_NAME}_db
</code></pre>

<p>All that remains now is to make the tables to run the ChemBio Hub application</p>

<pre><code>python manage.py migrate
python manage.py reindex_compounds
python manage.py reindex_datapoint_classifications
python manage.py createsuperuser
python manage.py collectstatic
</code></pre>

<p>Once these steps are done, in order to run the system in production, a few more steps are required to link the front end and back end up, to ensure the processes keep running and to secure the application.</p>

<p>If you have any questions about the procedures described in this post, please contact me my email address is in the link at the top of the post. Alternativley you can leave a comment on this post below.</p>
 <a class="scrollToTop blue pull-right">Back to top <span class="glyphicon glyphicon-upload"></span></a> <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'chembiohub'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js?https';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

</div>


			</div>

			<div class="col-md-3 col-xs-12">
				<div class="archive">
	<h2 class="blue"><span class="glyphicon glyphicon-home"></span> <a href="/blog/">All posts</a></h2>
	<ul id="archive">
	
		<li><a href="/blog/2015/12/24/uxoxford-network-prepare-for-failure.html">UXOxford - consider your network and prepare for failure</a><br/><abbr>24 Dec 2015</abbr></li>
	
		<li><a href="/blog/2015/12/10/installation.html">Managing the ChemBio Hub Platform installation with conda and pip</a><br/><abbr>10 Dec 2015</abbr></li>
	
		<li><a href="/blog/2015/10/15/good-data-management.html">Good data management practice in academia - What are your options?</a><br/><abbr>15 Oct 2015</abbr></li>
	
		<li><a href="/blog/2015/09/08/rdkit-ugm-2105.html">RDKit UGM 2015 - A ChemBio Hub perspective</a><br/><abbr>08 Sep 2015</abbr></li>
	
		<li><a href="/blog/2015/07/27/conversation-warmup.html">One week to go! Current Expertise and Future Directions In Drug Discovery</a><br/><abbr>27 Jul 2015</abbr></li>
	
		<li><a href="/blog/2015/03/10/pains.html">Pan-Assay Interference Compounds (PAINS) - what they are & why they matter</a><br/><abbr>10 Mar 2015</abbr></li>
	
		<li><a href="/blog/2015/03/10/introducing-chemreg-compound-registration-system.html">Introducing ChemReg - The ChemBio Hub compound registration system</a><br/><abbr>10 Mar 2015</abbr></li>
	
		<li><a href="/blog/2014/12/19/open-innovation.html">The Future of Drug Discovery - Open Innovation</a><br/><abbr>19 Dec 2014</abbr></li>
	
		<li><a href="/blog/2014/12/15/registration-workshop.html">Workshop on recording and managing data related to small molecules - 9th December 2014</a><br/><abbr>15 Dec 2014</abbr></li>
	
		<li><a href="/blog/2014/12/09/opencon-2.html">Some thoughts from Open Con 2014&#58; discovery tools</a><br/><abbr>09 Dec 2014</abbr></li>
	
		<li><a href="/blog/2014/12/01/opencon-1.html">Some thoughts from OpenCon 2014&#58; open data</a><br/><abbr>01 Dec 2014</abbr></li>
	
		<li><a href="/blog/2014/11/13/rails-development.html">Beginning developing in Rails</a><br/><abbr>13 Nov 2014</abbr></li>
	
		<li><a href="/blog/2014/11/13/oxcbh-symposium.html">The first ChemBio Hub Symposium - what happened?</a><br/><abbr>13 Nov 2014</abbr></li>
	
		<li><a href="/blog/2014/11/11/symp-survey.html">ChemBio Hub 2014 Symposium walk-up survey results</a><br/><abbr>11 Nov 2014</abbr></li>
	
		<li><a href="/blog/2014/10/22/oommppaa-directed-synthesis-data-analysis-tool.html">OOMMPPAA - directed synthesis and data analysis tool</a><br/><abbr>22 Oct 2014</abbr></li>
	
		<li><a href="/blog/2014/10/02/UX-in-scientific-software.html">UX in Scientific Software</a><br/><abbr>02 Oct 2014</abbr></li>
	
		<li><a href="/blog/2014/09/30/chembiocrunch-a-data-management-tool.html">ChemBio Crunch - A simple tool to analyse and manipulate ChemBio assay data</a><br/><abbr>30 Sep 2014</abbr></li>
	
		<li><a href="/blog/2014/09/02/setting-up.html">Setting up the ChemBioHub blog</a><br/><abbr>02 Sep 2014</abbr></li>
	
	</ul>
</div>
			</div>

		</div>


	</div>



    <div id="footer" class="footer">
    	<div class="container">
            
    		<div class="row ">

    			<!-- Postal address -->
                <a id="contact"></a>
                <button class="btn pull-right scrollToTop btn-lg">Back to top <span class="glyphicon glyphicon-upload"></span> </button>
    			<div class="col-md-4 col-sm-6 col-xs-11" id="postal-address">
    				<div class="row">
	    				<div class="col-xs-1">
	    					<span class="glyphicon glyphicon-home"></span>
	    				</div>
	    				<div class="col-xs-10">
	    					<span>ChemBio Hub Project<br/>
		    				Old Road Campus Research Building<br/>
		    				Roosevelt Drive<br/>
		    				Oxford OX3 7DQ</span>
	    				</div>
	    			</div>

	    			<div class="row">
	    				<div class="col-xs-1">
	    					<span class="glyphicon glyphicon-earphone"></span>
	    				</div>
	    				<div class="col-xs-10">
	    					<span>01865 617577</span>
	    				</div>
	    			</div>
    				
    			</div>

    			<div class="col-md-3 col-sm-6 hidden-xs">
    				<div class="row">
	    				<a href="https://twitter.com/oxchembiohub" onclick='return !window.open(this.href);'><img src="/assets/img/social-icons/twitter.png" class="social-icon" alt="twitter logo" title="twitter logo" /> Follow @OxChemBioHub</a><br/>
	    				<a href="mailto:info@chembiohub.ox.ac.uk"><img src="/assets/img/social-icons/mail-icon.png" class="social-icon" alt="email logo" title="email logo" /> Email ChemBio Hub</a><br/>
	    				<a href="https://plus.google.com/106725711668905271458" onclick='return !window.open(this.href);'><img src="/assets/img/social-icons/google+.png" class="social-icon" alt="google+ logo" title="google+ logo" /> Follow +OxChemBioHub</a>
	    			</div>
    			</div>

                

    		</div>

    		<div class="row center">


    			<div class="hidden-xs funding">
    				<div class="row">
    					We gratefully acknowledge the support of the following organisations:
    				</div>
    				<div class="row">

    					<img src="/assets/img/funders/ndm.png" title="Nuffield Department of Medicine Medical Sciences Division" alt="Nuffield Department of Medicine Medical Sciences Division"/>
    					<img src="/assets/img/funders/welcome.png" title="Supported by Wellcome Trust" alt="Supported by Wellcome Trust"/>
    					<img src="/assets/img/funders/hefce.png" title="Higher Education Funding Council For England" alt="Higher Education Funding Council For England" />
    					<img src="/assets/img/funders/johnfell.png" title="John Fell Fund" alt="John Fell Fund"/>

    				</div>
    			</div>

    			<div onclick="window.location='/about#funding'" class="visible-xs">
    				Thank you to our funding partners
    			</div>

    		</div>

    		<div class="row center copyright">

    			Copyright University of Oxford 2016 <!-- || Accessibility || Sitemap || Cookie policy -->

    		</div>

    	</div>
    </div>


    
     <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
     <script type="text/javascript" src="/assets/js/vendorjs/bootstrapValidator.min.js"></script>
     <script type="text/javascript" src="/assets/js/vendorjs/d3.min.js"></script>
    <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-55063522-1');ga('send','pageview');


/* Track outbound links in Google Analytics */
(function($) {
 
  "use strict";
 
  // current page host
  var baseURI = window.location.host;
 
  // click event on body
  $("body").on("click", function(e) {
 
    // abandon if link already aborted or analytics is not available
    if (e.isDefaultPrevented() || typeof ga !== "function") return;
 
    // abandon if no active link or link within domain
    var link = $(e.target).closest("a");
    if (link.length != 1 || baseURI == link[0].host) return;

    // cancel event and record outbound link
    e.preventDefault();
    var href = link[0].href;
    ga('send', {
      'hitType': 'event',
      'eventCategory': 'outbound',
      'eventAction': 'link',
      'eventLabel': href,
      'hitCallback': loadPage
    });
 
    // redirect after one second if recording takes too long
    setTimeout(loadPage, 1000);
 
    // redirect to outbound page
    function loadPage() {
      document.location = href;
    }
 
  });
 
})(jQuery); 

$(document).ready(function() {
    $('.scrollToTop').click(function(){
        $('html, body').animate({scrollTop : 0},800);
        return false;
    });
    $('#floating-register').affix({
      /*offset: {
        top: 100,
        bottom: function () {
          return (this.bottom = $('.footer').outerHeight(true) + 40)
        }
      }*/
    })

});
</script>

   

    <script type="text/javascript" src="/assets/js/vendorjs/jquery.contenthover.min.js"></script>

</body>
</html>
